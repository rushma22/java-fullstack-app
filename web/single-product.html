<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TechTopia | Product</title>
    <link rel="stylesheet" href="assets/css/notification.css">
  <style>
    /* === Same theme as index.html === */
    :root{
      --tt-bg:#0f172a;        /* body bg */
      --tt-card:#111827;      /* panels/cards */
      --tt-text:#e5e7eb;      /* primary text */
      --tt-muted:#94a3b8;     /* secondary text */
      --tt-accent:#22d3ee;    /* cyan accent */
      --tt-ring:rgba(34,211,238,.35);
      --tt-green:#a7f3d0;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: #0b1220;     /* matches index.html */
      color: var(--tt-text);
    }

    /* ===== Header (identical to index.html) ===== */
    header.tt-header {
      position: sticky; top: 0; z-index: 40;
      background: linear-gradient(180deg, rgba(15,23,42,.98), rgba(15,23,42,.90));
      border-bottom: 1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(8px) saturate(140%);
    }
    .tt-wrap { max-width:1200px; margin:0 auto; padding:14px 18px; display:flex; align-items:center; justify-content:space-between; }
    .tt-logo { color: var(--tt-text); font-weight:800; font-size:20px; text-decoration:none; letter-spacing:.3px; }
    .tt-logo::after{ content:""; display:inline-block; margin-left:.5rem; width:.5rem; height:.5rem; border-radius:50%; background:var(--tt-accent); box-shadow:0 0 10px var(--tt-accent); }
    nav ul { display:flex; gap:8px; margin:0; padding:0; list-style:none; }
    nav a {
      color: var(--tt-text); text-decoration:none; font-weight:600;
      padding:9px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.02);
      transition: background .15s ease, transform .15s ease, box-shadow .15s ease;
    }
    nav a:hover { background: rgba(34,211,238,.10); transform: translateY(-1px); }
    nav a.active { background: rgba(34,211,238,.18); box-shadow: 0 0 0 3px var(--tt-ring) inset; }

    /* ===== Layout ===== */
    .container{ max-width:1200px; margin:auto; padding:24px; }
    .product-display{ display:flex; flex-wrap:wrap; gap:20px; }
    .product-images, .product-details{
      flex:1 1 45%; background: var(--tt-card); padding:16px; border-radius:12px;
      border:1px solid rgba(255,255,255,.06);
    }

    /* ===== Images ===== */
    #image-main{ width:100%; max-height:300px; object-fit:contain; border-radius:6px; background:rgba(255,255,255,.03); }
    .thumbnails{ display:flex; gap:8px; margin-top:12px; }
    .thumbnails img{
      width:60px; height:60px; object-fit:cover; border-radius:6px;
      border:2px solid transparent; cursor:pointer; background:rgba(255,255,255,.03);
      transition: border-color .15s ease, transform .15s ease;
    }
    .thumbnails img:hover{ border-color: var(--tt-accent); transform: translateY(-1px); }
    .thumbnails img.active{ border-color: var(--tt-accent); box-shadow: 0 0 0 3px var(--tt-ring); }

    /* ===== Details ===== */
    .product-details h2{ margin-top:0; color: var(--tt-text); }
    .price{ color: var(--tt-green); font-size:1.4rem; font-weight:800; margin:.5rem 0; }
    .product-meta li{ list-style:none; margin:.25rem 0; color: var(--tt-muted); }
    .color-box, .storage-box{
      display:inline-block; padding:6px 10px; margin-right:10px;
      border-radius:8px; background: rgba(255,255,255,.05); font-size:.92rem;
    }
    .color-box .color{ display:inline-block; width:16px; height:16px; border-radius:50%; margin-left:8px; vertical-align:middle; border:1px solid #000; }

    /* ===== Actions ===== */
    .add-to-cart{ margin-top:1rem; display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    .add-to-cart input{
      width:72px; padding:8px; text-align:center; border-radius:8px;
      border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03); color:var(--tt-text);
    }
    .btn{
      border:none; padding:9px 12px; border-radius:10px; font-weight:700; cursor:pointer;
    }
    .btn-primary{ background: var(--tt-accent); color:#001017; }
    .btn-primary:hover{ filter:brightness(1.07); }
    .btn-danger{ background:#ef4444; color:#fff; }
    .btn-danger:hover{ filter:brightness(1.07); }

    /* ===== Similar Products ===== */
    .similar-products{ margin-top:32px; }
    .similar-products h3{ border-bottom:1px solid rgba(255,255,255,.06); padding-bottom:8px; margin-bottom:12px; }
    .product-list{ display:flex; gap:14px; flex-wrap:wrap; }
    .product-card{
      background: var(--tt-card); border-radius:10px; padding:12px;
      border:1px solid rgba(255,255,255,.06); width: calc(25% - 10px); box-sizing: border-box;
    }
    .product-card img{ width:100%; height:150px; object-fit:contain; margin-bottom:8px; background:rgba(255,255,255,.03); border-radius:6px; }
    .product-card h5{ margin:6px 0; font-size:1rem; color: var(--tt-text); }
    .product-card .price{ color: var(--tt-green); font-size:1rem; }
    @media (max-width:900px){ .product-card{ width: calc(33.333% - 10px); } }
    @media (max-width:600px){ .product-card{ width: calc(50% - 10px); } }
  </style>
</head>

<body onload="loadData();">
  <!-- ===== Header (same as index) ===== -->
  <header class="tt-header" id="main-header">
    <div class="tt-wrap">
      <a href="index.html" class="tt-logo" aria-label="TechTopia Home">TechTopia</a>
      <nav aria-label="Primary">
        <ul>
         <li><a id="nav-home" href="index.html">Home</a></li>
          <li><a id="nav-profile" href="my-account.html">My Profile</a></li>
          <li><a id="nav-search" href="search.html">Search</a></li>
          <li><a id="nav-cart" href="cart.html">My Cart</a></li>
          <li><a id="nav-about" href="about.html">About Us</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="container">
    <div class="product-display">
      <!-- Images -->
      <div class="product-images">
        <img id="image-main" src="assets/images/product/product-01.jpg" alt="Main Image">
        <div class="thumbnails" id="thumbs">
          <img class="thumb" data-image="1" src="assets/images/product/product-01.jpg" alt="Thumb 1">
          <img class="thumb" data-image="2" src="assets/images/product/product-01.jpg" alt="Thumb 2">
          <img class="thumb" data-image="3" src="assets/images/product/product-01.jpg" alt="Thumb 3">
        </div>
      </div>

      <!-- Details -->
      <div class="product-details">
        <h2 id="product-title">Product Title</h2>
        <p><strong>Published on:</strong> <span id="published-on">Date</span></p>
        <p class="price">Rs. <span id="product-price">0.00</span></p>
        <ul class="product-meta">
          <li><strong>Brand:</strong> <span id="brand-name"></span></li>
          <li><strong>Model:</strong> <span id="model-name"></span></li>
          <li><strong>Quality:</strong> <span id="product-quality"></span></li>
          <li><strong>Stock:</strong> <span id="product-stock"></span> Units</li>
        </ul>

        <div class="color-box"> Color: <span class="color" id="color-background"></span> </div>
        <div class="storage-box"> Storage: <span id="product-storage"></span> </div>

        <p><strong>Description:</strong></p>
        <p id="description">No description available.</p>

        <div class="add-to-cart">
          <input type="text" id="add-to-cart-qty" value="1">
          <button id="add-to-cart-main" class="btn btn-primary">Add to Cart</button>
        </div>
      </div>
    </div>

    <!-- Similar Products -->
    <div class="similar-products">
      <h3>Similar Products</h3>
      <div class="product-list" id="smiler-product-main"></div>
    </div>
  </div>

  <footer style="background:rgba(15,23,42,.9);color:var(--tt-text);text-align:center;padding:1rem;margin-top:2rem;">
    <p>&copy; 2025 TechTopia. All rights reserved.</p>
  </footer>

  <script>
    // Keep your existing function names/IDs
    async function loadData() {
      const searchParams = new URLSearchParams(window.location.search);
      if (!searchParams.has("id")) return;
      const productId = searchParams.get("id");

      const response = await fetch("LoadSingleProduct?id=" + productId);
      if (!response.ok) return;

      const json = await response.json();
      if (!json.status) return;

      const product = json.product;

      // Main + thumbs
      setMainImageSrc(product.id, 1);
      document.querySelectorAll(".thumb").forEach((el, i) => {
        const idx = i + 1;
        el.src = `product-images/${product.id}/image${idx}.jpg`;
        el.onclick = () => setMainImage(idx, product.id);
      });
      // mark first active
      markThumbActive(1);

      // Details
      document.getElementById("product-title").textContent = product.title;
      document.getElementById("published-on").textContent = product.created_at;
      document.getElementById("product-price").textContent =
        new Intl.NumberFormat("en-US", { minimumFractionDigits: 2 }).format(product.price);
      document.getElementById("brand-name").textContent = product.model.brand.name;
      document.getElementById("model-name").textContent = product.model.name;
      document.getElementById("product-quality").textContent = product.quality.value;
      document.getElementById("product-stock").textContent = product.qty;
      document.getElementById("color-background").style.backgroundColor = product.color.value;
      document.getElementById("product-storage").textContent = product.storage.value;
      document.getElementById("description").textContent = product.description;

      // Add to cart
      document.getElementById("add-to-cart-main").onclick = (e) => {
        e.preventDefault();
        addToCart(product.id, document.getElementById("add-to-cart-qty").value);
      };

      // Similar products
      const similerProductMain = document.getElementById("smiler-product-main");
      similerProductMain.innerHTML = "";
      json.productList.forEach(item => {
        const div = document.createElement("div");
        div.className = "product-card";
        div.innerHTML = `
          <a href="single-product.html?id=${item.id}" style="text-decoration:none;color:inherit;">
            <img src="product-images/${item.id}/image1.jpg" alt="Product Image"
                 onerror="this.src='product-images/${item.id}/image2.jpg'">
            <h5>${item.title}</h5>
            <p>${item.storage.value}</p>
            <div class="price">Rs. ${new Intl.NumberFormat("en-US", { minimumFractionDigits: 2 }).format(item.price)}</div>
          </a>`;
        similerProductMain.appendChild(div);
      });
    }

    // === Helpers to mirror index behavior ===
    function setMainImageSrc(productId, idx){
      const main = document.getElementById("image-main");
      main.src = `product-images/${productId}/image${idx}.jpg`;
      main.onerror = function(){ this.src = `product-images/${productId}/image1.jpg`; };
    }
    function setMainImage(idx, productId){
      setMainImageSrc(productId, idx);
      markThumbActive(idx);
    }
    function markThumbActive(idx){
      document.querySelectorAll(".thumb").forEach(t => t.classList.remove("active"));
      const el = document.querySelector(`.thumb[data-image="${idx}"]`);
      if(el) el.classList.add("active");
    }


    // Keep your backend call name/signature
    async function addToCart(productId, qty) {
      const popup = new Notification();
      const response = await fetch(`AddToCart?prId=${productId}&qty=${qty}`);
      if (!response.ok) return popup.error({ message: "Something went wrong. Try again" });
      const json = await response.json();
      if (json.status) popup.success({ message: json.message });
      else popup.error({ message: "Something went wrong. Try again" });
    }

    // highlight nav like index.html
    (function(){
      const file = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
      const map = { 'index.html':'nav-home', 'my-account.html':'nav-profile','search.html':'nav-search','cart.html':'nav-cart', 'about.html':'nav-about' };
      const id = map[file]; if(id){ const el = document.getElementById(id); el && el.classList.add('active'); }
    })();
  </script>

  <script src="assets/js/notification.js"></script>
</body>
</html>
